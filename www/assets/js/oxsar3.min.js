window.__gameStripImages__={init:function(b,a,c,h,r){void 0===b&&(b=".strip");void 0===a&&(a=2);void 0===c&&(c=0);void 0===h&&(h=300);if(void 0===r){r=[];for(var q=0;q<a;q++)r.push(q)}$(b).each(function(){var b=$(this);if(!b.data("strip_initialized")){b.css({display:"block",position:"relative",overflow:"hidden"});var q=b.find("img").css({position:"absolute",left:0,top:0}),e=new Image,u=function(){if(e.onload){e.onload=void 0;var t=e.width/a;b.css({width:t+"px",height:e.height+"px"});b.data("strip_initialized",
!0);q.css("left",Math.round(t*-r[0])+"px");setTimeout(function(){var a=0;setInterval(function(){a=(a+1)%r.length;var b=Math.round(t*-r[a]);0<c?q.animate({left:b},c):q.css("left",b+"px")},h)},h*Math.random())}else console.log("[StripImages] duplicate onload for",e.src)};e.onload=u;setTimeout(function(){e.src=q.attr("src");setTimeout(function(){e.onload&&0<e.width&&u()},1)},1);b.data("strip_initialized",!0)}})}};"use strict";
(function(b){function a(a,b){if(!a)throw b||"assert failed";return a}window.oxsar3={main:function(c){var h=c.mapId||"map-canvas",r=a(c.baseUrl,"baseUrl required"),q=a(c.loadTileDataUrl,"loadTileDataUrl required"),d=r+"/assets/img/rule-horiz.png",B=r+"/assets/img/rule-vert.png",e=r+"/assets/img/galaxy-bg/2.jpg",u=c.backgroundImageOpacity||0.1,t=c.backgroundFadeOpacity||0,s=c.galaxy||1,z=a(c.horizSize,"horizSize required"),G=a(c.vertSize,"vertSize required"),f=a(c.ruleSize,"ruleSize required"),T=a(c.tileSize,
"tileSize required"),U=c.viewEdgeSize||1,V=c.ruleWidth||30,W=c.ruleHeight||30;b.widget("game.galaxymap",{options:{},_create:function(){function a(O,k){O&&(k["background-image"]="url('"+O+"')");return k}function c(a,k){var b;void 0===b&&(b=1);a+=123*b;k+=123*b;return"rgb("+((300*a+50*k)%256|0)+","+((70*a+20*k)%256|0)+","+((100*a+150*k)%256|0)+")"}function h(){var a=new Date;return(a.getTime()+a.getMilliseconds()/1E3)/1E3}function X(){E=void 0;for(var a=0;2>a;a++)3E3<Math.abs(n[a])&&(n[a]=3E3*(0>n[a]?
-1:1));H=setInterval(function(){for(var a=0;2>a;a++)n[a]*=0.85,20>Math.abs(n[a])&&(n[a]=0);if(n[0]||n[1]){var a=h(),b=Math.max(0.01,a-J);J=a;P.moveToOffs(C[0]+n[0]*b,C[1]+n[1]*b)}else clearInterval(H)},50)}console.log("galaxyMap._create",this);var P=this,D=b('<table><tr><td class="galaxy-map-corner"></td><td class="galaxy-map-horiz-rule"></td></tr><tr><td class="galaxy-map-vert-rule"></td><td class="galaxy-map-content bg-full-size"></td></tr></table>').css({"border-collapse":"collapse","border-spacing":0,
padding:0,margin:0,width:"100%",height:"100%"}).appendTo(this.element);D.find("td").css({padding:0,margin:0});var Q=D.find(".galaxy-map-horiz-rule").css(a(d,{"background-repeat":"repeat-x","background-position":"left bottom",position:"relative",overflow:"hidden",height:W+"px"})),R=D.find(".galaxy-map-vert-rule").css(a(B,{"background-repeat":"repeat-y","background-position":"right top",position:"relative",overflow:"hidden",width:V+"px"})),I=D.find(".galaxy-map-content").css({position:"relative",overflow:"hidden"}),
M=null;e&&(M=b('<div class="bg-full-size"></div>').css({opacity:u||0.2,"background-image":"url('"+e+"')","background-position":"50% 50%","background-repeat":"no-repeat",position:"absolute",left:0,top:0,width:"100%",height:"100%"}).hide().fadeIn(3E3).appendTo(I));0<t&&I.append(b("<div />").css({"background-color":"black",opacity:t,position:"absolute",left:0,top:0,width:"100%",height:"100%"}));var S=b("<div />").css({position:"absolute"}).appendTo(I),K={},L=0,C=[0,0];this.getOffs=function(){return[C[0],
C[1]]};this.moveToOffs=function(a,k){function t(c){c.c?c.visible?void 0!==c.d?c.d==B?console.log("break loading tile ",c.x,c.y,"it is has already loaded"):console.log("break loading tile ",c.x,c.y,"due loading in progress"):(c.d=u,b.ajax({type:"POST",cache:!1,dataType:"json",data:{x:c.x,y:c.y,g:s},url:q,error:function(a,b,k){console.log("error loading tile, step",0,c,b,k,a)},success:function(e){if(c.c){c.d=B;console.log(e);for(var l=b("<div />").appendTo(c.c).hide().fadeIn(1E3),h=0;h<e.data.length;h++)for(var m=
e.data[h],n=0;n<m.length;n++){var g=m[n];if(g){var t=l,y=h,w=n;console.log("initTileElement",g);var q=g,s=r+"/assets/img/planets/sun-shine-01.png",p=r+"/assets/img/planets/sun-shine-02.png",d=q.size*f,v=0.5*d,u=g=void 0,x=void 0,s=b("<div />").css({position:"absolute",left:q.x,top:q.y}).append(g=b("<img>").attr("src",s).css({cursor:"pointer",position:"absolute",width:d,height:d,top:-d/2,left:-d/2})).append(u=b("<img>").attr("src",s).css({cursor:"pointer",position:"absolute",width:d,height:d,top:-d/
2,left:-d/2})).append(x=b("<img>").attr("src",p).css({cursor:"pointer",position:"absolute",width:0.27*d,height:0.27*d,top:0.27*-d/2,left:0.27*-d/2})),p={0:0,1:45,2:90,3:135,4:180,5:225,6:270,7:315};if(p=p[q.type||0])g.css("-webkit-filter","hue-rotate("+p+"deg)"),u&&u.css("-webkit-filter","hue-rotate("+p+"deg)"),x&&x.css("-webkit-filter","hue-rotate("+p+"deg)");q=(new TimelineMax({repeat:-1})).set(u,{opacity:0.8}).set(x,{opacity:0.9,scale:1.3}).to(g,v,{rotation:360,ease:"linear"},0).to(u,v,{rotation:-360,
ease:"linear"},0).to(x,v,{rotation:1440,ease:"linear"},0).to(x,v/4,{scale:0.9,ease:"linear"},0).to(x,v/4,{scale:1.3,ease:"linear"},1*v/4).to(x,v/4,{scale:0.9,ease:"linear"},2*v/4).to(x,v/4,{scale:1.3,ease:"linear"},3*v/4).to(x,v/4,{opacity:0.5,ease:"linear"},0).to(x,v/4,{opacity:0.9,ease:"linear"},1*v/4).to(x,v/4,{opacity:0.5,ease:"linear"},2*v/4).to(x,v/4,{opacity:0.9,ease:"linear"},3*v/4).play(v*Math.random());s.data("timeline",q).data("shine1",g).data("shine2",u).data("shine3",x);s.appendTo(t).css({left:(y+
0.5)*f,top:(w+0.5)*f})}}}else console.log("loaded tile ",a,k," is not exist")}})):console.log("break loading tile ",c.x,c.y,"it is not visible"):console.log("break loading tile ",c.x,c.y,"it has already removed")}var y=I.width(),w=I.height(),g,p,l=U;a=a<y+(z[1]+l)*-f+1?y+(z[1]+l)*-f+1:a>-(z[0]-l)*f?-(z[0]-l)*f:a;k=k<w+(G[1]+l)*-f+1?w+(G[1]+l)*-f+1:k>-(G[0]-l)*f?-(G[0]-l)*f:k;C=[a,k];Q.css({"background-position":a+"px bottom"}).empty();g=a%f-f;for(p=(g-a)/f|0;g<y+f;g+=f,p++)l=b("<div />").text(p).addClass("galaxy-map-rule-number").css({position:"absolute"}).appendTo(Q),
l.css({left:g-l.width()/2+1,bottom:15});R.css({"background-position":"right "+k+"px"}).empty();g=k%f-f;for(p=(g-k)/f|0;g<w+f;g+=f,p++)l=b("<div />").text(p).addClass("galaxy-map-rule-number").css({position:"absolute"}).appendTo(R),l.css({top:g-l.height()/2+1,right:15});l=0;g=-(z[0]-l)*f+y/2;g=2*((a-g)/(p=-(z[1]+l)*f+y/2-g)-0.5);var e=-(G[0]-l)*f+w/2,m,l=2*((k-e)/(m=-(G[1]+l)*f+w/2-e)-0.5);Math.abs(p)>Math.abs(m)?(e=45,p=45*m/p):(e=45*p/m,p=45);M&&M.css({"background-position":50+(-35>g*e*2?-35:35<
g*e*2?35:g*e*2)+"% "+(50+(-35>l*p*2?-35:35<l*p*2?35:l*p*2))+"%"});S.css({left:a,top:k});L++;a=-a;k=-k;var h=T*f;g=a;p=k;l=a+y;e=k+w;m=a/h|0;var y=m+Math.ceil(1*y/h),n=m;m-=2;for(var y=y+(n-m+Math.max(1,2)),n=k/h|0,w=n+Math.ceil(1*w/h)+1,d=n,n=n-2,w=w+(d-n+Math.max(1,2)),u=0,B=1,A=m;A<y;A++)for(var F=n;F<w;F++){void 0===K[A]&&(K[A]={});var D=A*h-f/2,E=F*h-f/2,d=D+h>=g&&D<l&&E+h>=p&&E<e;void 0===K[A][F]?d&&(console.log("create tile",A,F),function(){var a=K[A][F]={x:A,y:F,tick:L,visible:!0,h:!1,c:b("<div />").css({position:"absolute",
left:D,top:E,width:h,height:h}).appendTo(S).append(b("<div />").css({position:"absolute","background-color":c(A,F),opacity:0.1,width:"100%",height:"100%"})).hide().fadeIn(2E3).queue(function(){a.h=!0;t(a)})}}()):(m=K[A][F],m.tick=L,(m.visible=d)&&m.h&&void 0===m.d&&t(m))}for(var J in K){var w=K[J],H;for(H in w)m=w[H],m.tick!=L&&(console.log("delete tile",m.x,m.y),m.visible=!1,m.c.stop(!0).remove(),delete m.c,delete w[H])}};this.centerToXY=function(a,c){var b=I.width(),d=I.height();this.moveToOffs(-a*
f+b/2,-c*f+d/2)};this.centerMap=function(){this.centerToXY((z[1]+z[0])/2,(G[1]+G[0])/2)};var E,N,n=[],J=0,H;I.bind("dragstart",function(a,c){E=[c.offsetX,c.offsetY];N=C;J=h();clearInterval(H)}).bind("dragend",function(){X()}).bind("drag",function(a,c){if(void 0!==E){var b=c.offsetX-E[0],d=c.offsetY-E[1];if(!(1>b*b+d*d)){var e=[C[0],C[1]];P.moveToOffs(N[0]+b,N[1]+d);b=h();d=Math.max(0.01,b-J);J=b;n=[(C[0]-e[0])/d,(C[1]-e[1])/d]}}});this._destroy=function(){clearInterval(H);D.remove()};this.widget=
function(){return D};this.centerMap()}});b("#"+h).galaxymap()}}})(jQuery);
window.__gameTooltips__={e:!1,opacity:1,tooltip:null,a:[{x:0,y:0},{x:0,y:0}],f:null,b:null,init:function(b){var a=this;b||(b="");$(b+" .game-tooltip-content").each(function(){var a=$(this);a.data("tooltip_initialized")||(a.remove(),$("body #"+a.attr("id")).remove(),a.appendTo(document.body).hide().css({opacity:"",position:"absolute",left:-9E4,top:-9E4,"z-index":1E4}),a.data("tooltip_initialized",!0))});a.e?a.hide():(a.e=!0,$(".game-tooltip").live("mouseover",function(){var b=$(this),h;!b.hasClass("game-tooltip-disabled")&&
(h=b.attr("lang"))&&(clearTimeout(a.f),a.f=setTimeout(function(){var r=$("#game-tooltip-content-"+h);if(r.length&&(!a.tooltip||a.tooltip.attr("id")!=r.attr("id"))){a.hide();var q=$(window),d=q.scrollLeft()+5,B=q.scrollTop()+5,e=q.width()-10,q=q.height()-10,u=b.offset(),t=u.top+b.height()+5,s=u.left+5,z=!1;s+r.width()<d+e?(s<d&&(s=d),a.a[0].x=s,a.a[1].x=s+10):(s=Math.min(d+e-r.width(),u.left+b.width()-r.width()-5),s<d&&(s=d),a.a[0].x=s,a.a[1].x=s-10);t+r.height()<B+q?(t<B&&(t=B),a.a[0].y=t,a.a[1].y=
t+10,a.a[1].x=a.a[0].x):(t=u.top-r.height()-5,t<B?(t=B,z=!0,s=Math.min(d+e-r.width(),u.left-r.width()-5),s<d&&(s=d),a.a[0].x=s,a.a[1].x=s-10):a.a[1].x=a.a[0].x,a.a[0].y=t,a.a[1].y=t-(z?0:10));(a.tooltip=r).css({left:a.a[1].x,top:a.a[1].y})}a.show()},70))}),$(".game-tooltip-content").live("mouseover",function(){a.tooltip&&a.tooltip.attr("id")==$(this).attr("id")&&a.show();return!1}),$(".game-tooltip, .game-tooltip-content").live("mouseout",function(){clearTimeout(a.b);a.b=setTimeout(function(){a.hide()},
1E3);return!1}),$(".game-tooltip-content").live("click",function(){a.hide();return!1}))},hide:function(){clearTimeout(this.b);this.b=void 0;this.tooltip&&(this.tooltip.css("z-index",1E4),this.tooltip.stop(!0).animate({opacity:0,left:this.a[1].x,top:this.a[1].y},400,"easeInQuad",function(){$(this).hide().css({left:-9E4,top:-9E4})}),this.tooltip=void 0)},show:function(){clearTimeout(this.b);this.b=void 0;this.tooltip&&(this.tooltip.css("z-index",10001),this.tooltip.stop(!0).show().animate({opacity:this.opacity,
left:this.a[0].x,top:this.a[0].y},400,"easeOutCubic"))}};
